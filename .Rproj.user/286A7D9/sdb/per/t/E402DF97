{
    "collab_server" : "",
    "contents" : "## ---- API demo ----\n## ---- remapBDemo ----\n## ---- pauseFunction ----\npause <- function(){\n    invisible(readline(\"\\nPress <return> to continue: \"))\n}\nlibrary(REmap)\nlibrary(bamapr)\n## Test for Bmap\n\n################################################################################\n####                    标注施工、事故信息                            ##########\n################################################################################\ndata(fzdat)\n\nset.seed(1234)\nindex=which(threeRing_n$line$color==\"#FF0000\")\npointData = data.frame(sample(threeRing_n$point$index[index],2),\n                       color = c(rep(\"red\",2)))\nremapB(center = get_city_coord(\"福州\"),\n       zoom = 14,\n       title = \"福州三环\",\n       color = \"googlelite\",\n       markPointData = pointData,\n       markPointTheme = markPointControl(symbol = 'circle',\n                                         symbolSize = 15,\n                                         effect = T),\n       markLineData = threeRing_n[[2]],\n       markLineTheme = markLineControl(smoothness = 0,lineWidth=3,\n                                       effect = F,lineType = \"solid\",\n                                       symbolSize = c(0,0)),\n       geoData = threeRing_n$point[c(\"Lon\",\"Lat\",\"index\")])\n\npause <- function(){\n    invisible(readline(\"\\nPress <return> to continue: \"))\n}\nweb_path=\"http://www.iconpng.com/png/cristal-intense/travaux.png\"\nremapB(center = get_city_coord(\"福州\"),\n       zoom = 14,\n       title = \"福州三环\",\n       color = \"googlelite\",\n       markPointData = pointData,\n       markPointTheme = markPointControl(\n           symbol = paste(\"image://\",web_path,sep=\"\"),\n                                         symbolSize = 30,\n                                         effect = F),\n       markLineData = threeRing_n[[2]],\n       markLineTheme = markLineControl(smoothness = 0,lineWidth=3,\n                                       effect = F,lineType = \"solid\",\n                                       symbolSize = c(0,0)),\n       geoData = threeRing_n$point[c(\"Lon\",\"Lat\",\"index\")])\n\n\n\n\n\n\n################################################################################\n####                    交通拥堵情况                                  ##########\n################################################################################\npause()\n\nif (!require(devtools)) install.packages(\"devtools\")\ndevtools::install_github('lchiffon/wordcloud2')\n\ndata(road)\nlibrary(jiebaR)\nwk = worker(stop_word='data/stopword.txt')\nroadQ=table(wk[road])\nlibrary(wordcloud2)\nwordcloud2(roadQ)\n\npause()\npointData=data.frame(name=as.factor(bus[,1]),color=\"#7CCD7C\")\ngeodata=bus[,c(4,5,1)]\nremapB(center = get_city_coord(\"福州\"),\n       zoom = 14,\n       title = \"福州公交\",\n       color = \"googlelite\",\n       markPointData = pointData,\n       markPointTheme = markPointControl(symbol = 'pin',\n                                         symbolSize = 5,\n                                         effect = F),\n       geoData = geodata)\n\n################################################################################\n####                    福州公交站点                                  ##########\n################################################################################\npause()\ndata(fzbus)\nlibrary(REmap)\nbus$name=paste(bus$name,bus$id,sep=\"\")\npointData=data.frame(name=bus[,\"name\"],color=\"#7CCD7C\")\ngeodata=bus[,c(\"lon_bd\",\"lat_bd\",\"name\")]\n# geodata$lon=as.numeric(geodata$lon)\n# geodata$lat=as.numeric(geodata$lat)\n#转换成百度地图\nlonlat=data.frame(geoconv(geodata[c(1:2)]))\ncolnames(lonlat)=c(\"lon_bd\",\"lat_bd\")\nbus=cbind(bus,lonlat)\nremapB(center = get_city_coord(\"福州\"),\n       zoom = 14,\n       title = \"福州公交站分布图\",\n       color = \"googlelite\",\n       markPointData = pointData,\n       markPointTheme = markPointControl(symbol = 'pin',\n                                         symbolSize = 5,\n                                         effect = F),\n       geoData = geodata)\ncat(\"福州全市（含五区八县）共\",nrow(bus),\"个公交车站\\n\")\nroute=unlist(strsplit(bus$address,split = \"[;/\\\\.]\"))\nroute=route[!duplicated(route)]\nroute=route[-38]\nroute_dy=route[-grep(pattern = \"停运\",x = route)]\ncat(\"福州全市（含五区八县）共\",length(route_dy),\"个公交线路\\n\")\n\n################################################################################\n####                    福州公交路线                                  ##########\n################################################################################\n\npause()\ncat(\"公交路线及其站点查询\\n\")\nroad=\"1路\"\nx=getBusRoute(keywords=road)\nhead(x)\nll=getBusRoute(keywords=road,getcoord=T,gettime=T)\ncat(\"公交路线早晚班时间\\n\")\nll[[2]]\ncat(\"公交路线路径地图\\n\")\ny=ll[[3]]\ny[1,1]=gsub(pattern = \"\\\\]\",replacement = \"\",x = y[1,1])\nmtx=matrix(as.numeric(unlist(strsplit(y[1,1],split = \",\"))),ncol=2,byrow=T)\n#转换为百度地图坐标\nmtx=geoconv(geocode = mtx,from = 3, to = 5)\ngeodata=mtx2geoData(mtx,name = road)\n#geodata先经度后维度\n#col=rgb(red =252,green = 249,blue =0.5 )\nlinedata=mtx2lineData(mtx = mtx,name = road,color =\"#00F5FF\")\n\n\nremapB(center = get_city_coord(\"福州\"),\n       zoom = 14,\n       title = paste(\"福州\",road,\"公交\",sep=\"\"),\n       color = \"googlelite\",\n\n       markLineData =linedata,\n       markLineTheme = markLineControl(smoothness = 0,lineWidth=3,\n                                       effect = F,lineType = \"solid\",\n                                       symbolSize = c(0,0)),\n       geoData = geodata[,c(2,1,3)])\n\n################################################################################\n####                    主要道路画图                                  ##########\n################################################################################\n\npause()\n\n# road=list.files(\"data/fz\")\n# point=data.frame(matrix(rep(NA,5),ncol=5))\n# colnames(point)=c(\"Lon\",\"Lat\",\"index\",\"name\",\"direction\")\n# line=data.frame(matrix(rep(NA,4),ncol=4))\n# colnames(line)=c(\"origin\",\"destination\",\"color\",\"symbol\")\n# for(i in 1:length(road)){\n#\n#     path0=paste(\"data/fz/\",road[i],sep=\"\")\n#     filename=unlist( strsplit(road[i],split = \"-+\"))\n#     name=unlist( strsplit(road[i],split = \"\\\\.\"))[1]\n#     direction=unlist( strsplit(filename[2],split = \"\\\\.\"))[1]\n#     tmp=cleanData(path=path0,name =name,direction = direction)\n#     point=rbind(point,tmp$point)\n#     line=rbind(line,tmp$line)\n# }\n# point=na.omit(point)\n# line=na.omit(line)\ndata(fzroad)\nlibrary(REmap)\nremapB(center = get_city_coord(\"福州\"),\n       zoom = 14,\n       title = \"福州路网\",\n       color = \"googlelite\",\n       markLineData =line,\n       markLineTheme = markLineControl(smoothness = 0,lineWidth=5,\n                                       effect = F,lineType = \"solid\",\n                                       symbolSize = c(0,0)),\n       geoData = point[,c(1,2,3)])\n\n################################################################################\n####                    OD对期望图                                    ##########\n################################################################################\npause()\n\ndata(fzbus)\nbus_sample=bus[sample(1:nrow(bus),size = 50,replace = F),]\nc=matrix(rep(NA,nrow(bus_sample)^2),ncol=nrow(bus_sample))\ncolnames(c)=bus_sample$name\nrownames(c)=bus_sample$name\nc[is.na(c)]=\"#9F79EE\"\nlibrary(reshape2)\nlineData3=melt(c)\ncolnames(lineData3)=c(\"origin\",\"destination\",\"color\")\npointData3=data.frame(name=as.factor(bus_sample[,\"name\"]),color=\"#7CCD7C\")\ngeoData3=bus_sample[,c(\"lon_bd\",\"lat_bd\",\"name\")]\n\nremapB(center = get_city_coord(\"福州\"),\n       zoom = 14,\n       title = \"OD对期望图\",\n       color = \"googlelite\",\n       markPointData = pointData3,\n       markPointTheme = markPointControl(symbol = 'pin',\n                                         symbolSize = 2,\n                                         effect = F),\n       markLineData = lineData3,\n       markLineTheme = markLineControl(smoothness = 0,lineWidth=0.1,\n                                       effect = F,lineType = \"solid\",\n                                       symbolSize = c(0,0)),\n\n       geoData = geoData3)\n\n################################################################################\n####                    批量爬取福鼎道路信息                          ##########\n################################################################################\n # rectangel=matrix(c(120.208958,27.327244,120.232389,27.30612),byrow = T,nrow = 2)\n # df=getSearchPlus(mtx = rectangel,word = '道路',types = '19',Tobaidu = T)\n # adcode=amapcity[amapcity$名称==\"福鼎市\",]$adcode\n # geoData=list()\n # lineData=list()\n # for(i in 1:nrow(df)){\n #         tmp=getRoadCoor(id = df[i,1],tobaidu = T,name=df[i,2])\n #         geoData[[i]]=tmp$geodata\n #         lineData[[i]]=tmp$linedata\n # }\n #\n # geoData1=do.call(rbind,geoData)\n # lineData1=do.call(rbind,lineData)\ndata(fds)\n geoData1=na.omit(geoData1)\n\n lineData1=na.omit(lineData1)\n lineData1$color=\"#00F5FF\"\n\n remapB(center = get_city_coord(\"福鼎\"),\n        zoom = 15,\n        title = \"批量抓取的福鼎某个区域道路\",\n        color = \"googlelite\",\n        markLineData = lineData1,\n        markLineTheme = markLineControl(smoothness = 0,lineWidth=2,\n                                        effect = F,lineType = \"solid\",\n                                        symbolSize = c(0,0)),\n\n        geoData = geoData1)",
    "created" : 1483947959975.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2502727585",
    "id" : "E402DF97",
    "lastKnownWriteTime" : 1483968036,
    "last_content_update" : 1483968036065,
    "path" : "C:/Users/dai_jl/Desktop/bamapr/demo/mapdemo.R",
    "project_path" : "demo/mapdemo.R",
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}