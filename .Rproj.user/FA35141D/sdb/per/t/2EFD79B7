{
    "collab_server" : "",
    "contents" : "---\ntitle: \"基于Web地图的交通信息分析及可视化展示平台\"\nauthor: \"bamapr by 戴剑林\"\ndate: \"2017年1月10日\"\noutput: slidy_presentation\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = F,warning = F,fig.align='center')\nlibrary(REmap)\nlibrary(bamapr)\nlibrary(wordcloud2)\nlibrary(flexdashboard)\n```\n\n## 项目背景介绍\n- web地图数据接口(API)  \n\n <http://lbs.amap.com/api/webservice/summary/>  \n \n <http://lbsyun.baidu.com/index.php?title=webapi>.\n\n- web地图时效性、移植性强\n\n\n- 图片的核心是数据\n\n\n - 数据处理步骤  \n     + 数据抓取  \n     + 数据清洗\n     + 数据存储\n     + 数据挖掘  \n     + 可视化展示  \n\n## 近期工作内容\n- 批量抓取POI信息（如公交站点）\n- 批量抓取公交路线\n- 批量抓取路网信息（以福鼎为例）\n- 批量抓取拥堵情况\n- 叠加事故标志\n- 叠加施工标志\n- OD对期望图\n\n\n## 批量抓取公交站点\n公交站点:![figure 1](p1.png)\n```{r }\ndata(fzbus)\nbus$name=paste(bus$name,bus$id,sep=\"\")\npointData=data.frame(name=bus[,\"name\"],color=\"#7CCD7C\")\ngeodata=bus[,c(\"lon_bd\",\"lat_bd\",\"name\")]\n# geodata$lon=as.numeric(geodata$lon)\n# geodata$lat=as.numeric(geodata$lat)\n#转换成百度地图\nlonlat=data.frame(geoconv(geodata[c(1:2)]))\ncolnames(lonlat)=c(\"lon_bd\",\"lat_bd\")\nbus=cbind(bus,lonlat)\n\nremapB(center = get_city_coord(\"福州\"),\n       zoom = 14,\n       title = \"福州公交站分布图\",\n       color = \"googlelite\",\n       markPointData = pointData,\n       markPointTheme = markPointControl(symbol = 'pin',\n                                         symbolSize = 5,\n                                         effect = F),\n       geoData = geodata)\n\ncat(\"福州全市（含五区八县）共\",nrow(bus),\"个公交车站\\n\")\nroute=unlist(strsplit(bus$address,split = \"[;/\\\\.]\"))\nroute=route[!duplicated(route)]\nroute=route[-38]\nroute_dy=route[-grep(pattern = \"停运\",x = route)]\ncat(\"福州全市（含五区八县）共\",length(route_dy),\"个公交线路\\n\")\n```\n\n\n## 公交路线\n公交路线:![figure 2](p2.png)\n```{r }\ncat(\"公交路线及其站点查询\\n\")\nroad=\"1路\"\nx=getBusRoute(keywords=road)\nhead(x)\nll=getBusRoute(keywords=road,getcoord=T,gettime=T)\ncat(\"公交路线早晚班时间\\n\")\nll[[2]]\ncat(\"公交路线路径地图\\n\")\ny=ll[[3]]\ny[1,1]=gsub(pattern = \"\\\\]\",replacement = \"\",x = y[1,1])\nmtx=matrix(as.numeric(unlist(strsplit(y[1,1],split = \",\"))),ncol=2,byrow=T)\n#转换为百度地图坐标\nmtx=geoconv(geocode = mtx,from = 3, to = 5)\ngeodata=mtx2geoData(mtx,name = road)\n#geodata先经度后维度\n#col=rgb(red =252,green = 249,blue =0.5 )\nlinedata=mtx2lineData(mtx = mtx,name = road,color =\"#00F5FF\")\n\n\nremapB(center = get_city_coord(\"福州\"),\n       zoom = 14,\n       title = paste(\"福州\",road,\"公交\",sep=\"\"),\n       color = \"googlelite\",\n\n       markLineData =linedata,\n       markLineTheme = markLineControl(smoothness = 0,lineWidth=3,\n                                       effect = F,lineType = \"solid\",\n                                       symbolSize = c(0,0)),\n       geoData = geodata[,c(2,1,3)])\n```\n\n\n## 批量抓取路网信息\n路网: ![figure 3](p3.png)\n```{r}\ndata(fds)\ngeoData1=na.omit(geoData1)\n\nlineData1=na.omit(lineData1)\nlineData1$color=\"#00F5FF\"\n\nremapB(center = get_city_coord(\"福鼎\"),\n       zoom = 15,\n       title = \"批量抓取的福鼎某个区域道路\",\n       color = \"googlelite\",\n       markLineData = lineData1,\n       markLineTheme = markLineControl(smoothness = 0,lineWidth=2,\n                                       effect = F,lineType = \"solid\",\n                                       symbolSize = c(0,0)),\n\n       geoData = geoData1)\n```\n\n\n## 批量抓取拥堵情况\n```{r fig.align='center',echo=TRUE}\ndata(trafficstatus)\ndf=trafficstatus[!trafficstatus$expedite==\"100.00%\",]\ntra_list=list()\nfor(i in 1:nrow(df)){\n        a=unlist(strsplit(df$description[i],split = \"；\"))\n        tra_list[[i]]=data.frame(road=a,\n        expedite=rep(df$expedite[i],length(a)),\n        congested=rep(df$congested[i],length(a)),\n        blocked  =rep(df$blocked  [i],length(a)),\n        unknown  =rep(df$unknown  [i],length(a)),\n        stringsAsFactors = F)\n}\ndfx=do.call(rbind,tra_list)\ndfx$expedite=gsub(pattern = \"\\\\%\",replacement = \"\",x = dfx$expedite)\ndfx$road=unlist(strsplit(dfx$road,split = \"：\"))[seq(1, by = 2,length.out = nrow(dfx))]\ndfx$expedite=100-as.numeric(dfx$expedite)\n# cat(\"拥堵情况表：\\n\")\n# head(dfx)\nprint(paste(\"路况监控时段\",df$time[1],sep=\"\"))\n\nwordcloud2(dfx,size = 0.3)\n\n\n\n```\n\n- 最拥堵路段的拥堵占比\n```{r,echo=TRUE}\nindex=which.min(dfx$expedite)\ngauge(100-dfx[index,2], min = 0, max = 100, symbol = '%', gaugeSectors(\n  success = c(0, 10), warning = c(11, 89), danger = c(90, 100)\n))\n```\n\n## 叠加事故标志\n叠加事故标志:![figure 4](p4.png)\n\n\n```{r }\ndata(fzdat)\n\nset.seed(1234)\nindex=which(threeRing_n$line$color==\"#FF0000\")\npointData = data.frame(sample(threeRing_n$point$index[index],2),\n                       color = c(rep(\"red\",2)))\nremapB(center = get_city_coord(\"福州\"),\n       zoom = 14,\n       title = \"福州三环\",\n       color = \"googlelite\",\n       markPointData = pointData,\n       markPointTheme = markPointControl(symbol = 'circle',\n                                         symbolSize = 15,\n                                         effect = T),\n       markLineData = threeRing_n[[2]],\n       markLineTheme = markLineControl(smoothness = 0,lineWidth=3,\n                                       effect = F,lineType = \"solid\",\n                                       symbolSize = c(0,0)),\n       geoData = threeRing_n$point[c(\"Lon\",\"Lat\",\"index\")])\n\n\n\n```\n\n\n\n\n## 叠加施工标志\n叠加施工标志:![figure 5](p5.png)\n```{r}\ndata(fzdat)\nset.seed(1234)\nindex=which(threeRing_n$line$color==\"#FF0000\")\npointData = data.frame(sample(threeRing_n$point$index[index],2),\n                       color = c(rep(\"red\",2)))\nweb_path=\"http://www.iconpng.com/png/ios7_icons/road_worker.png\"\nremapB(center = get_city_coord(\"福州\"),\n       zoom = 14,\n       title = \"福州三环\",\n       color = \"googlelite\",\n       markPointData = pointData,\n       markPointTheme = markPointControl(\n           symbol = paste(\"image://\",web_path,sep=\"\"),\n                                         symbolSize = 30,\n                                         effect = F),\n       markLineData = threeRing_n[[2]],\n       markLineTheme = markLineControl(smoothness = 0,lineWidth=3,\n                                       effect = F,lineType = \"solid\",\n                                       symbolSize = c(0,0)),\n       geoData = threeRing_n$point[c(\"Lon\",\"Lat\",\"index\")])\n```\n\n\n## OD对期望图\nOD对期望图:![figure 6](p6.png)\n```{r}\ndata(fzbus)\nbus_sample=bus[sample(1:nrow(bus),size = 50,replace = F),]\nc=matrix(rep(NA,nrow(bus_sample)^2),ncol=nrow(bus_sample))\ncolnames(c)=bus_sample$name\nrownames(c)=bus_sample$name\nc[is.na(c)]=\"#9F79EE\"\nlibrary(reshape2)\nlineData3=melt(c)\ncolnames(lineData3)=c(\"origin\",\"destination\",\"color\")\npointData3=data.frame(name=as.factor(bus_sample[,\"name\"]),color=\"#7CCD7C\")\ngeoData3=bus_sample[,c(\"lon_bd\",\"lat_bd\",\"name\")]\n\nremapB(center = get_city_coord(\"福州\"),\n       zoom = 14,\n       title = \"OD对期望图\",\n       color = \"googlelite\",\n       markPointData = pointData3,\n       markPointTheme = markPointControl(symbol = 'pin',\n                                         symbolSize = 2,\n                                         effect = F),\n       markLineData = lineData3,\n       markLineTheme = markLineControl(smoothness = 0,lineWidth=0.1,\n                                       effect = F,lineType = \"solid\",\n                                       symbolSize = c(0,0)),\n\n       geoData = geoData3)\n```\n\n## 应用场景\n- 公交专项规划\n- 选址规划\n- 叠加实时公交信息的公交到达率分析\n- 各个时段Top10拥堵路段\n- 标定城市交通仿真模型参数\n- 反向校核道路修建、改造后的效果\n- 出行服务\n- 基于百度热力图的重庆职住研究 <http://www.udparty.com/topic/1568.html/>\n- 其他.....\n\n## 下一步工作\n- 完善功能：抓取拥堵路段的经纬度信息（50%）\n- 完善功能：完善路网连通性\n- 完善功能：导入CAD道路平面成果\n- 数据挖掘......\n\n",
    "created" : 1483982182522.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3057593460",
    "id" : "2EFD79B7",
    "lastKnownWriteTime" : 1490437269,
    "last_content_update" : 1490453492981,
    "path" : "C:/Users/DAI/git/bamapr/demo/mapslidly.Rmd",
    "project_path" : "demo/mapslidly.Rmd",
    "properties" : {
        "docOutlineVisible" : "0"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}